{% extends 'base.html' %}

{% load thumbnail %}


{% block extra_header %}
    <style type="text/css">
        .teamedup-form .upload-button {
            position: relative;
            bottom: 50px;
            right: 10px;
            border-radius: 50%;
        }
        input[type=file] {
            width: 1px;
            visibility: hidden;
        }
    </style>
{% endblock %}

{% block content %}

    <div class="container">

        <form enctype="multipart/form-data" method="POST" class="teamedup-form">

            {% csrf_token %}
            <div class="row">
                <div class="columns">
                    <h5 class="title">Account Settings</h5>
                    <p class="description">ACCOUNT SETTINGS</p>
                </div>
            </div>
            <div class="row">
                <div class="large-4 medium-3 small-12 columns text-right">
                    {% thumbnail request.user.profile.userpic "350x350" as userpic %}
                        <img class="userpic-preview" src="{{ userpic.url }}" />
                    {% empty %}
                        <img class="userpic-preview" src="http://placehold.it/350x350&text=Picture" />
                    {% endthumbnail %}
                    <a href="#" class="button alert round upload-button"><i class="fa fa-upload"></i></a>
                </div>
                <div class="large-7 medium-9 small-12 columns">
                    <div class="row">
                        <div class="columns" style="color:red;">
                            {{ form.non_field_errors }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="columns">
                            <div class="row">
                                <div class="columns">
                                    <label>
                                        Name
                                        {{ form.name }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="columns">
                                    <label>
                                        Email
                                        {{ form.email }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="columns">
                                    <label>
                                        Password
                                        {{ form.password }}
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="columns">
                                    <label>
                                        Repeat Password
                                        {{ form.repeat_password }}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="columns text-center">
                    <input type="submit" class="button alert hide-for-small-only" value="Save Settings" />
                    <input type="submit" class="button alert expanded show-for-small-only" value="Save Settings" />
                    <i class="fa fa-spinner fa-spin" style="display: none;" aria-hidden="true"></i>
                </div>
            </div>
            <input type="file" onchange="previewFile()" name="userpic">
        </form>

    </div>

    {% if organizations %}
    <div class="container">
        {% for organization in organizations %}
            <div class="row">
                <div class="columns teamedup-form">
                    <div class="row">
                        <div class="large-8 medium-7 small-5 columns">
                            <h5 class="title">{{ organization.name }}</h5>
                            <p class="description">ORGANIZATION SETTINGS</p>
                        </div>
                        <div class="large-4 medium-5 small-7 columns">
                            <div class="row">
                                <div class="large-8 medium-8 small-8 columns">
                                    <input type="email" style="margin-top:0;" />
                                </div>
                                <div class="columns">
                                    <button class="alert small button"><i class="fa fa-send"></i> Invite</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% for member in organization.members %}
                        <div class="row" id="member_{{ member.pk }}">
                            <div class="large-2 medium-2 small-4 columns">
                                {% thumbnail member.profile.userpic "200x200" crop="center" as userpic %}
                                    <img class="userpic-preview image-rounded" src="{{ userpic.url }}" />
                                {% empty %}
                                    <img class="userpic-preview image-rounded" src="http://placehold.it/200x200&text=Picture" />
                                {% endthumbnail %}
                            </div>
                            <div class="large-10 medium-10 small-8 columns">
                                <div class="row">
                                    <div class="large-7 medium-7 small-12 columns">
                                        <h6 class="title">{{ member.profile.get_name }}</h6>
                                        <p class="description">{{ member.email }}</p>
                                        <div class="show-for-small-only">
{#                                        {% if member.pk != request.user.pk %}#}
                                            <button class="secondary button" style="margin-right: 20px;">Make admin</button>
                                            <button class="secondary button">Remove</button>
{#                                        {% endif %}#}
                                        </div>
                                    </div>
                                    <div class="large-5 medium-5 small-12 columns hide-for-small-only text-right">
{#                                        {% if member.pk != request.user.pk %}#}
                                            <button class="secondary button" style="margin-right: 20px;">Make admin</button>
                                            <button class="secondary button">Remove</button>
{#                                        {% endif %}#}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <div class="row">
                        <div class="columns">&nbsp;</div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    {% endif %}

{% endblock %}


{% block extra_footer %}
    <script type="text/javascript">
        function previewFile(){
           var file    = document.querySelector('input[type=file]').files[0];
           var reader  = new FileReader();

           reader.onloadend = function () {
               $('img.userpic-preview').attr('src', reader.result)
           }

           if (file) {
               reader.readAsDataURL(file);
           } else {
               $('img.userpic-preview').attr('src', 'http://placehold.it/350x350&text=Picture')
           }
        }


        window.onload = function(){
            $('.upload-button').click(function(){
               $('input[type="file"]').click();
                return false;
            });

            $('.teamedup-form').submit(function(){
                $(this).find('input[type="submit"]').hide();
                $(this).find('.fa-spinner').show();
                return true;
            });

        }
    </script>
{% endblock %}
